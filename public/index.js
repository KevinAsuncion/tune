'use strict'

const ENTRY = [
    {
        image_url: 'https://images.ctfassets.net/v3n26e09qg2r/5AIMm6UcI8cYIWMsU8AqEq/d88942bfb655b82e1e2edfbd1ea5dcb8/About-02-1008x1008.svg',
        photo_meaning: '0 Spicy jalapeno brisket sint leberkas lorem turducken culpa. Aliqua cupidatat duis filet mignon, deserunt leberkas tongue turkey occaecat enim shank meatloaf ut.',
        grateful: '0 Spicy jalapeno brisket sint leberkas lorem turducken culpa. Aliqua cupidatat duis filet mignon, deserunt leberkas tongue turkey occaecat enim shank meatloaf ut.',
        best_self: '0 Spicy jalapeno brisket sint leberkas lorem turducken culpa. Aliqua cupidatat duis filet mignon, deserunt leberkas tongue turkey occaecat enim shank meatloaf ut.',
        created_date: moment().format("dddd, MMMM Do YYYY"),
    },
    {
        image_url: 'https://images.ctfassets.net/v3n26e09qg2r/5AIMm6UcI8cYIWMsU8AqEq/d88942bfb655b82e1e2edfbd1ea5dcb8/About-02-1008x1008.svg',
        photo_meaning: '1 Spicy jalapeno brisket sint leberkas lorem turducken culpa. Aliqua cupidatat duis filet mignon, deserunt leberkas tongue turkey occaecat enim shank meatloaf ut.',
        grateful: '1 Spicy jalapeno brisket sint leberkas lorem turducken culpa. Aliqua cupidatat duis filet mignon, deserunt leberkas tongue turkey occaecat enim shank meatloaf ut.',
        best_self: '1 Spicy jalapeno brisket sint leberkas lorem turducken culpa. Aliqua cupidatat duis filet mignon, deserunt leberkas tongue turkey occaecat enim shank meatloaf ut.',
        created_date: moment().format("dddd, MMMM Do YYYY"),
    },
    {
        image_url: 'https://images.ctfassets.net/v3n26e09qg2r/5AIMm6UcI8cYIWMsU8AqEq/d88942bfb655b82e1e2edfbd1ea5dcb8/About-02-1008x1008.svg',
        photo_meaning: '2 Spicy jalapeno brisket sint leberkas lorem turducken culpa. Aliqua cupidatat duis filet mignon, deserunt leberkas tongue turkey occaecat enim shank meatloaf ut.',
        grateful: '2 Spicy jalapeno brisket sint leberkas lorem turducken culpa. Aliqua cupidatat duis filet mignon, deserunt leberkas tongue turkey occaecat enim shank meatloaf ut.',
        best_self: '2 Spicy jalapeno brisket sint leberkas lorem turducken culpa. Aliqua cupidatat duis filet mignon, deserunt leberkas tongue turkey occaecat enim shank meatloaf ut.',
        created_date: moment().format("dddd, MMMM Do YYYY"),
    },
    {
        image_url: 'https://images.ctfassets.net/v3n26e09qg2r/5AIMm6UcI8cYIWMsU8AqEq/d88942bfb655b82e1e2edfbd1ea5dcb8/About-02-1008x1008.svg',
        photo_meaning: '3 Spicy jalapeno brisket sint leberkas lorem turducken culpa. Aliqua cupidatat duis filet mignon, deserunt leberkas tongue turkey occaecat enim shank meatloaf ut.',
        grateful: '3 Spicy jalapeno brisket sint leberkas lorem turducken culpa. Aliqua cupidatat duis filet mignon, deserunt leberkas tongue turkey occaecat enim shank meatloaf ut.',
        best_self: '3 Spicy jalapeno brisket sint leberkas lorem turducken culpa. Aliqua cupidatat duis filet mignon, deserunt leberkas tongue turkey occaecat enim shank meatloaf ut.',
        created_date: moment().format("dddd, MMMM Do YYYY"),
    },
    {
        image_url: 'https://images.ctfassets.net/v3n26e09qg2r/5AIMm6UcI8cYIWMsU8AqEq/d88942bfb655b82e1e2edfbd1ea5dcb8/About-02-1008x1008.svg',
        photo_meaning: '4 Spicy jalapeno brisket sint leberkas lorem turducken culpa. Aliqua cupidatat duis filet mignon, deserunt leberkas tongue turkey occaecat enim shank meatloaf ut.',
        grateful: '4 Spicy jalapeno brisket sint leberkas lorem turducken culpa. Aliqua cupidatat duis filet mignon, deserunt leberkas tongue turkey occaecat enim shank meatloaf ut.',
        best_self: '4 Spicy jalapeno brisket sint leberkas lorem turducken culpa. Aliqua cupidatat duis filet mignon, deserunt leberkas tongue turkey occaecat enim shank meatloaf ut.',
        created_date: moment().format("dddd, MMMM Do YYYY"),
    },
    {
        image_url: 'https://images.ctfassets.net/v3n26e09qg2r/5AIMm6UcI8cYIWMsU8AqEq/d88942bfb655b82e1e2edfbd1ea5dcb8/About-02-1008x1008.svg',
        photo_meaning: '5 Spicy jalapeno brisket sint leberkas lorem turducken culpa. Aliqua cupidatat duis filet mignon, deserunt leberkas tongue turkey occaecat enim shank meatloaf ut.',
        grateful: '5 Spicy jalapeno brisket sint leberkas lorem turducken culpa. Aliqua cupidatat duis filet mignon, deserunt leberkas tongue turkey occaecat enim shank meatloaf ut.',
        best_self: '5 Spicy jalapeno brisket sint leberkas lorem turducken culpa. Aliqua cupidatat duis filet mignon, deserunt leberkas tongue turkey occaecat enim shank meatloaf ut.',
        created_date: moment().format("dddd, MMMM Do YYYY"),
    },
    {
        image_url: 'https://images.ctfassets.net/v3n26e09qg2r/5AIMm6UcI8cYIWMsU8AqEq/d88942bfb655b82e1e2edfbd1ea5dcb8/About-02-1008x1008.svg',
        photo_meaning: '6 Spicy jalapeno brisket sint leberkas lorem turducken culpa. Aliqua cupidatat duis filet mignon, deserunt leberkas tongue turkey occaecat enim shank meatloaf ut.',
        grateful: '6 Spicy jalapeno brisket sint leberkas lorem turducken culpa. Aliqua cupidatat duis filet mignon, deserunt leberkas tongue turkey occaecat enim shank meatloaf ut.',
        best_self: '6 Spicy jalapeno brisket sint leberkas lorem turducken culpa. Aliqua cupidatat duis filet mignon, deserunt leberkas tongue turkey occaecat enim shank meatloaf ut.',
        created_date: moment().format("dddd, MMMM Do YYYY"),
    },
    {
        image_url: 'https://images.ctfassets.net/v3n26e09qg2r/5AIMm6UcI8cYIWMsU8AqEq/d88942bfb655b82e1e2edfbd1ea5dcb8/About-02-1008x1008.svg',
        photo_meaning: '7 Spicy jalapeno brisket sint leberkas lorem turducken culpa. Aliqua cupidatat duis filet mignon, deserunt leberkas tongue turkey occaecat enim shank meatloaf ut.',
        grateful: '7 Spicy jalapeno brisket sint leberkas lorem turducken culpa. Aliqua cupidatat duis filet mignon, deserunt leberkas tongue turkey occaecat enim shank meatloaf ut.',
        best_self: '7 Spicy jalapeno brisket sint leberkas lorem turducken culpa. Aliqua cupidatat duis filet mignon, deserunt leberkas tongue turkey occaecat enim shank meatloaf ut.',
        created_date: moment().format("dddd, MMMM Do YYYY"),
    }
]


//-------------Hero------------------//

function listenWelcomeSignUp() {
    $('.hero-signup-button').on('click', function () {
        toggleSignUpModal();
    })
}

//-----------------Login------------------//

function listenLogin() {
    $('.login-link').on('click', function () {
        toggleLoginModal();
    })
}

function listenLoginCloseButton() {
    $('.login-close-button').on('click', function () {
        toggleLoginModal();
    })
}

function toggleLoginModal() {
    $('.login-modal').toggleClass('show-modal')
}

//----------------Sign Up------------------//


function listenSignUp() {
    $('.signup-link').on('click', function (event) {
        toggleSignUpModal();
    })
}

function listenSignUpCloseButton() {
    $('.signup-close-button').on('click', function () {
        toggleSignUpModal();
    })
}

function toggleSignUpModal() {
    $('.signup-modal').toggleClass('show-modal')
}

//----------------Create Entry------------------//

function listenCreateEntry() {
    $('.create-new-entry-btn').on('click', function () {
        toggleCreateEntryModal();
    });
}

function listenCreateEntryCloseButton() {
    $('.create-entry-close-button').on('click', function () {
        toggleCreateEntryModal()
    });
}

function toggleCreateEntryModal() {
    $('.create-entry-modal').toggleClass('show-modal')
}

function createNewJournalEntry() {
    $('.create-entry-form').submit(e => {
        e.preventDefault();
        const image_url = $('.image-url-input').val();
        const meaningful_image = $('.meaning-image-input').val();
        const grateful = $('.grateful-input').val();
        const bestSelf = $('.bestself-input').val();
        $('.image-url-input').val('');
        $('.meaning-image-input').val('');
        $('.grateful-input').val('');
        $('.bestself-input').val('');
        ENTRY.push({
            image_url: image_url,
            photo_meaning: meaningful_image,
            grateful: grateful,
            best_self: bestSelf,
            created_date: moment().format("dddd, MMMM Do YYYY"),
        })
        renderDashboardJournalEntries(ENTRY);
        toggleCreateEntryModal();
        $('.entry-container').empty();
        if ($('.cancel-entry-btn, .edit-entry-btn, .delete-entry-btn').is(':visible')) {
            $('.cancel-entry-btn, .edit-entry-btn, .delete-entry-btn').toggle();
        }
    })
}

function renderDashboardJournalEntries(entries) {
    let journalEntries = entries.map(entry => {
        return {
            image_url: entry.image_url,
            created_date: entry.created_date,
        };
    });
    let journalEntriesList = journalEntries.map((entry, index) => {
        return `
            <div class="journal-entry-card" data-id="${index}">
                <img src="${entry.image_url}"/>
                <p class="journal-entry-date">${entry.created_date}</p>
                <div class="overlay">
                <button class="entry-view-btn">View</button>
                 </div>
            </div> 
        `
    })
    $('.journal-entries-container').html(journalEntriesList);
}

function getTheId() {
    $('.journal-entries-container').on('click', '.entry-view-btn', e => {
        const selectedId = parseInt($(e.currentTarget).parents('.journal-entry-card').attr('data-id'));
        renderViewEntry(selectedId);
    })
}

function renderViewEntry(selectedId) {
    const selectedEntry = ENTRY.find((entry, index) => {
        return index === selectedId;
    })


    $('.entry-container').html(
        `
      <span id="selected-id" data-id="${selectedId}"></span>
      <img src="${selectedEntry.image_url}" alt="meaningful-photo" class="meaningful-image-img"/>
        <h2 class="entry-meaningful-photo-heading">This photo means..</h2>
        <p class="meaningful-photo-entry">${selectedEntry.photo_meaning} </p>
        <h2 class="entry-grateful-heading">I am grateful for..</h2>
        <p class="grateful-entry">${selectedEntry.grateful} </p>
        <h2 class="entry-best-self-heading">My best self is..</h2>
        <p class="best-self-entry"> ${selectedEntry.best_self}</p>
    `)
    $('html,body').animate({
        scrollTop: $(".view-entry").offset().top
    }, 'slow');
    $('.create-new-entry-btn').toggle();//////////
    toggleEditAndDeleteButtons();
    $('.journal-entries-container').toggle();

}

function toggleEditAndDeleteButtons() {
    if ($('.cancel-entry-btn, .edit-entry-btn, .delete-entry-btn').is(':visible')) {
        return;
    }
    $('.cancel-entry-btn, .edit-entry-btn, .delete-entry-btn').toggle();
}

//----------------Edit Entry------------------//

function listenEditButton() {
    $('.edit-entry-btn').on('click', e => {
        toggleEditModal();
        const selectedId = parseInt($(e.currentTarget).parents('.view-entry').find('#selected-id').attr('data-id'));
        $('.edit-image-url-input').val(ENTRY[selectedId].image_url);
        $('.edit-meaning-image-input').val(ENTRY[selectedId].photo_meaning);
        $('.edit-grateful-input').val(ENTRY[selectedId].grateful);
        $('.edit-bestself-input').val(ENTRY[selectedId].best_self);
        $('.edit-selected-id').val(selectedId);
    });
}


function listenEditEntrySubmitButton() {
    $('.edit-entry-form').submit(e => {
        e.preventDefault();
        const selectedId = $('.edit-selected-id').val();
        const updated_image_url = $('.edit-image-url-input').val();
        const updated_meaning_image = $('.edit-meaning-image-input').val();
        const updated_grateful = $('.edit-grateful-input').val();
        const updated_best_self = $('.edit-bestself-input').val();
        const updated_created_date = moment().format("dddd, MMMM Do YYYY");

        const updatedEntry = {
            image_url: updated_image_url,
            photo_meaning: updated_meaning_image,
            grateful: updated_grateful,
            best_self: updated_best_self,
            created_date: updated_created_date
        }

        ENTRY.splice(selectedId, 1, updatedEntry);
        renderDashboardJournalEntries(ENTRY);
        toggleEditModal();
        $('.entry-container').empty();
        $('.cancel-entry-btn, .edit-entry-btn, .delete-entry-btn').toggle();
        $('.journal-entries-container').toggle();
        $('.create-new-entry-btn').toggle(); /////////////
    })

}

function listenEditCloseButton() {
    $('.edit-entry-close-button').on('click', function () {
        toggleEditModal();
    })
}

function toggleEditModal() {
    $('.edit-entry-modal').toggleClass('show-modal')
}

//-------------Cancel------------------//

function listenCancelButton() {
    $('.cancel-entry-btn').on('click', function () {
        $('.entry-container').empty();
        $('.cancel-entry-btn, .edit-entry-btn, .delete-entry-btn').toggle();

        if (!$('.journal-entries-container').is(':visible')) {
            $('.journal-entries-container').toggle();
        };

        if (!$('.create-new-entry-btn').is(':visible')) {
            $('.create-new-entry-btn').toggle(); /////////////
        };
    })
}




//-------------Delete------------------//

function listenDeleteButton() {
    $('.delete-entry-btn').on('click', e => {
        const selectedId = parseInt($(e.currentTarget).parents('.view-entry').find('#selected-id').attr('data-id'));
        ENTRY.splice(selectedId, 1);
        $('.entry-container').empty();
        $('.cancel-entry-btn, .edit-entry-btn, .delete-entry-btn').toggle();
        renderDashboardJournalEntries(ENTRY);
        $('.journal-entries-container').toggle()
        $('.create-new-entry-btn').toggle();
    });
}



//----------------Start App------------------//

function startApp() {
    listenWelcomeSignUp()
    listenLogin();
    listenLoginCloseButton();
    listenSignUp();
    listenSignUpCloseButton();
    listenCreateEntry();
    listenCreateEntryCloseButton();
    renderDashboardJournalEntries(ENTRY);
    createNewJournalEntry();
    getTheId();
    listenDeleteButton();
    listenEditButton();
    listenEditEntrySubmitButton();
    listenEditCloseButton();
    listenCancelButton()
}

$(startApp)

